define(["../../lib/jquery","../ga"],function(a,b){"use strict";var c={ERROR_NETWORK:"网络错误，请稍后重试",ERROR_RESPONSE:"服务器返回了错误的数据类型",linkToResult:"http://cn.bing.com/dict/search?q={{query}}",ttsLink:!1,method:"POST",url:"http://dict.bing.com.cn/io.aspx",data:{t:"dict",ut:"default",ulang:"ZH-CN",tlang:"EN-US",q:""},result2obj:function(a,d){var e={};e.to=d.to||"auto",e.from=a.ROOT.$LANG,e.response=a,e.linkToResult=c.linkToResult.replace("{{query}}",d.text);try{e.detailed=[],a.ROOT.DEF[0].SENS.forEach(function(a){var b=a.$POS+". ";Array.isArray(a.SEN)?a.SEN.forEach(function(a){b+=a.D.$+"; "}):b+=a.SEN.D.$,e.detailed.push(b)}),e.detailed=e.detailed.join("<br/><br/>")}catch(f){e.detailed=""}try{e.result=a.ROOT.SMT.R.$.replace(/\{\d+#|\$\d+\}/g,"")}catch(f){e.result="",console.error("必应返回了错误的数据："),console.error(a),b.track("必应返回了错误的json结构",JSON.stringify(a))}return e}},d=Object.freeze({id:"bing",name:"必应翻译",link:"http://cn.bing.com/dict/",translate:function(b,d){var e=a.extend({},c.data);return e.q=b.text,e.ulang=(b.from||"auto").toUpperCase(),e.tlang=(b.to||"auto").toUpperCase(),a.ajax({url:c.url,type:c.method,data:e,timeout:4e3,dataType:"json"}).done(function(a){var e;e=c.result2obj(a,b),e.response=a,d(e)}).fail(function(a,b){var c;"timeout"===b?c="查询时间超过了5秒，为避免发生错误已取消此次查询，请稍后重试。":"error"===b&&(c="查询时发生了网络错误，请先检查一下你的网络设置，然后重试。"),d({error:c})}),this},detectLanguage:function(a,b){return d.translate({text:a},function(a){b(a.from)}),this},speakUrl:function(a,b,c){return c(!1),this}});return d});